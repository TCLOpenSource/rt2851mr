#include <linux/kernel.h>
#include <linux/slab.h>
#include <linux/kthread.h>
#include <linux/pageremap.h>
#include <linux/syscalls.h>
#include <linux/delay.h>     // for msleep
#include <linux/freezer.h>
#include <tp/tp_reg_ctrl.h>
#include "atsc3_alp_lib.h"
#include <mach/io.h>
#include <rbus/timer_reg.h>

#define atsc3_alp_dmx_malloc(size)        kmalloc(size, GFP_KERNEL)
#define atsc3_alp_dmx_free(addr)          kfree(addr)

//#define USE_ALP_LIKE

/*======================================================
 * Func  : _atsc3_alp_dmx_thread_func
 *
 * Desc  : demux thread
 *
 * Param :
 *
 * Retn  :
 *======================================================*/
static int _atsc3_alp_dmx_thread_func(void *data)
{
    struct atsc3_alp_dmx* p_this = (struct atsc3_alp_dmx*) data;
    //wait_queue_head_t timeout_wq;
    //init_waitqueue_head(&timeout_wq);
    set_freezable();

    //while( !kthread_should_stop() ||( (p_this->flags & DMX_FLAG_THREAD_STOP) == 0) ) {
    while( !kthread_should_stop()) {
        p_this->ops.run(p_this);
        if (freezing(current)) {
            try_to_freeze();
        }
        usleep_range(1000, 1000);
        //wait_event_interruptible_timeout(timeout_wq, 0, 1);
    }

    p_this->flags &= ~(DMX_FLAG_THREAD_STOP | DMX_FLAG_THREAD_START);
    return 0;
}

/*======================================================
 * Func  : atsc3_alp_dmx_start
 *
 * Desc  : start atsc3_alp demux
 *
 * Param : handle of atsc3_alp dmx
 *
 * Retn  : 0 : successed, oethers failed
 *======================================================*/
int atsc3_alp_dmx_start(struct atsc3_alp_dmx* p_this)
{
        ATSC3_ALP_DMX_TRACE();

        if (p_this == NULL) {
                ATSC3_ALP_DMX_WARN("Enable ATSC3 ALP demux failed, invalid parameters\n");
                return -1;
        }

        // start thread here
        if (p_this->flags & DMX_FLAG_THREAD_START)
                return 0;

        p_this->flags &= ~DMX_FLAG_THREAD_STOP;
        p_this->flags |=  DMX_FLAG_THREAD_START;

        p_this->thread_id = kthread_run(_atsc3_alp_dmx_thread_func, p_this, "_atsc3_alp_dmx_thread_func");  /* no need to pass parameter into thread function */

        return 0;
}



/*======================================================
 * Func  : atsc3_alp_dmx_stop
 *
 * Desc  : stop atsc3_alp demux
 *
 * Param : handle of atsc3_alp dmx
 *
 * Retn  : 0 : successed, oethers failed
 *======================================================*/
int atsc3_alp_dmx_stop(struct atsc3_alp_dmx* p_this)
{
        ATSC3_ALP_DMX_TRACE();

        if (p_this == NULL) {
                ATSC3_ALP_DMX_WARN("Enable atsc3_alp demux failed, invalid parameters\n");
                return -1;
        }

        // stop thread here
        p_this->flags |= DMX_FLAG_THREAD_STOP;
        kthread_stop(p_this->thread_id);

        return 0;
}

/*======================================================
 * Func  : atsc3_alp_dmx_run
 *
 * Desc  :
 *
 * Param : handle of atsc3_alp dmx
 *
 * Retn  : 0 : successed, oethers failed
 *======================================================*/

int atsc3_alp_dmx_run_sony(struct atsc3_alp_dmx* p_this)
{
        unsigned char *p_rp, *p_rp_ori;
        UINT32 len, len_ori;
        static int sync_byte_len = 4;

        while (atsc3_alp_file_ring_read_data(&p_rp, &len, p_this->tp_id) == 0 && len) {
                p_rp_ori = p_rp;
                len_ori  = len;
                //ATSC3_ALP_DMX_ERROR("read data from ring buffer :{ %02x.%02x.%02x.%02x},p_rp_ori=%p,len_ori=%d\n", p_rp[0], p_rp[1], p_rp[2], p_rp[3],p_rp_ori,len_ori);
                while(len > 0) {
					
                        if (p_this->tsp_excepted_size == 0) {//general case
						
                                unsigned char* p_tsp;
                                unsigned int   data_len;
						
                                // fid packet header....
                                if( p_rp[0] == 0x47 && (p_rp[1] == 0x00 || p_rp[1] == 0x40) && p_rp[2] == 0x2D) {
                                        p_tsp = p_rp;
                                } else {
                                        p_tsp = atsc3_alp_find_packet_starter(p_rp, len, sync_byte_len);
                                }
						
                                if (p_tsp == NULL) {
                                        //drop all len data due to not found the packet header when tsp_excepted_size == 0
                                        //may be this case only happen on the first time when we read data from ring buffer
                                        p_rp = p_rp + len; 
                                        len  = len - len; 
                                        ATSC3_ALP_DMX_ERROR("alp re-sync 1 can not find sync byte p_rp=%p len=%d\n", p_rp, len);
                                        continue;
                                }

                                ATSC3_ALP_DMX_DBG("read packet shift:%d,left len=%d (%p) = { %02x.%02x.%02x.%02x},alp_buff_zize=%ld\n",
                                                (p_tsp-p_rp),len,p_tsp,p_tsp[0], p_tsp[1], p_tsp[2], p_tsp[3],p_this->alp_buff_zize);
                                if (p_tsp > p_rp) {
                                        //we need drop the data that before the first 188 packet,because there is no alp now
                                        //we think this case only happen on the first time when we read data from ring buffer
                                        data_len = (unsigned int)(p_tsp - p_rp);
                                        p_rp = p_rp + data_len; 
                                        len  = len - data_len;
                                        ATSC3_ALP_DMX_ERROR("tlv re-sync 2 p_rp=%p len=%d drop data_len=%d\n", p_rp, len, data_len);
                                }
						
                                if (len < 188) { 
                                        //when the last data is less than 188,we need set the tsp_excepted_size to 188, and store this data to tsp buffer
                                        //once we read from ring buffer again,we can get the left data of 188, we need store the packet data
                                        p_this->tsp_excepted_size = ATSC3_ALP_HDR_SIZE;
                                        memcpy(p_this->tsp_buffer, p_rp, len);      // store temp buffer
                                        p_this->tsp_buff_size     = len;            
                                        p_rp = p_rp + len; 
                                        len  = len - len; 
                                } else {
                                        ATSC3_ALP_DMX_DBG(" 188 packet data \n");
                                        if(p_tsp[1]==0x00){
                                                if(p_this->alp_buff_zize > 0 ){
                                                        //collect ALP content
                                                        ATSC3_ALP_DMX_DBG("47 00 2d ,just copy 185 byte\n");
                                                        memcpy(p_this->alp_buffer + p_this->alp_buff_zize, p_tsp+3, 185);
                                                        p_this->alp_buff_zize = p_this->alp_buff_zize + 185;
                                                }else{
                                                        //abandon the the first imcomplete ALP packet data
                                                        ATSC3_ALP_DMX_DBG("the first incomplete alp ,just drop ! { %02x.%02x.%02x.%02x}\n", p_tsp[0], p_tsp[1], p_tsp[2], p_tsp[3]);
                                                }
                                        }else if(p_tsp[1]==0x40){
								
                                                UINT8 alp_start_pointer,last_alp_size;
                                                alp_start_pointer = last_alp_size = p_tsp[3];
                                                ATSC3_ALP_DMX_DBG("alp_start_pointer :=%d(0x%02x)\n", alp_start_pointer,alp_start_pointer);
								
                                                if(p_this->alp_buff_zize > 0){
                                                        //copy the last packet data of the ALP to alp_buffer
                                                        ATSC3_ALP_DMX_DBG("collect the last packet data ,the remain data len :=%d\n", last_alp_size);
                                                        memcpy(p_this->alp_buffer + p_this->alp_buff_zize, p_tsp+4, last_alp_size);
                                                        p_this->alp_buff_zize = p_this->alp_buff_zize + last_alp_size;
                                                }
										
                                                if(p_this->alp_buff_zize >= ATSC3_ALP_HDR_SIZE ){
                                                        //collect alp finish, delivery	ALP 
                                                        ATSC3_ALP_DMX_DBG("delivery ALP { %02x.%02x.%02x.%02x }, alp len=%ld\n", p_this->alp_buffer[0], p_this->alp_buffer[1], p_this->alp_buffer[2], p_this->alp_buffer[3],p_this->alp_buff_zize);
                                                        p_this->cb.callback(p_this, 0x00, p_this->alp_buffer, 0, p_this->alp_buff_zize , 0x00, 0x00);
                                                        p_this->alp_buff_zize = 0;
                                                }
									
                                                if(alp_start_pointer!=0xB8){
                                                        //collect the next new ALP
                                                        ATSC3_ALP_DMX_DBG("collect the new first packet data ,data len :=%d\n", 184-alp_start_pointer);
                                                        memcpy(p_this->alp_buffer + p_this->alp_buff_zize, p_tsp+4+alp_start_pointer, 184-alp_start_pointer);
                                                        p_this->alp_buff_zize = p_this->alp_buff_zize +184-alp_start_pointer;
                                                }
									
                                        }
                                        p_rp = p_rp + 188; 
                                        len  = len - 188; 
                                }
					
                        }else if (p_this->tsp_excepted_size == ATSC3_ALP_HDR_SIZE) {
						
                                ATSC3_ALP_DMX_DBG("tsp_excepted_size==188, len=%d,tsp_buff_size=%d,alp_buff_zize=%ld \n", len,p_this->tsp_buff_size,p_this->alp_buff_zize);
                                if ( (len + p_this->tsp_buff_size) < ATSC3_ALP_HDR_SIZE) { 
                                        ATSC3_ALP_DMX_DBG("tsp_excepted_size==188 (len + p_this->tsp_buff_size) < ATSC3_ALP_HDR_SIZE ,len=%d,tsp_buff_size=%d\n", len,p_this->tsp_buff_size);
                                        //when the data len is less than 188, keep on cache to tsp_buffer
                                        memcpy(p_this->tsp_buffer + p_this->tsp_buff_size, p_rp, len);      // store temp buffer
                                        p_this->tsp_buff_size = p_this->tsp_buff_size + len;            
                                        p_rp = p_rp + len; 
                                        len  = len - len; 
                                } else {
                                        //Generally,we can get the data large than 188, but we just handle one packet data
                                        unsigned char process_size = ATSC3_ALP_HDR_SIZE - p_this->tsp_buff_size;
                                        memcpy(p_this->tsp_buffer + p_this->tsp_buff_size, p_rp, process_size);         // store temp buffer
                                        p_rp = p_rp + process_size; 
                                        len  = len - process_size; 
                                        ATSC3_ALP_DMX_DBG("tsp_excepted_size==188 (len + p_this->tsp_buff_size) > ATSC3_ALP_HDR_SIZE ,tsp_buffer{ %02x.%02x.%02x.%02x }\n", p_this->tsp_buffer[0],p_this->tsp_buffer[1],p_this->tsp_buffer[2],p_this->tsp_buffer[3]);
                                        //handle the tsp buffer 
                                        if(p_this->tsp_buffer[1]==0x00 && (p_this->alp_buff_zize > 0 )){
                                                //collect ALP content
                                                ATSC3_ALP_DMX_DBG("47 00 2d ,just copy 185 byte\n");
                                                memcpy(p_this->alp_buffer + p_this->alp_buff_zize, p_this->tsp_buffer+3, 185);
                                                p_this->alp_buff_zize = p_this->alp_buff_zize + 185;
                                        }else if(p_this->tsp_buffer[1]==0x40){
                                                UINT8 alp_start_pointer,last_alp_size;
                                                alp_start_pointer = last_alp_size = p_this->tsp_buffer[3];
                                                ATSC3_ALP_DMX_DBG("alp_start_pointer :=%d(0x%02x)\n", alp_start_pointer,alp_start_pointer);
								
                                                if(p_this->alp_buff_zize > 0){
                                                        //copy the last packet data of the ALP to alp_buffer
                                                        ATSC3_ALP_DMX_DBG("collect the last packet data ,the remain data len :=%d\n", last_alp_size);
                                                        memcpy(p_this->alp_buffer + p_this->alp_buff_zize, p_this->tsp_buffer+4, last_alp_size);
                                                        p_this->alp_buff_zize = p_this->alp_buff_zize + last_alp_size;
                                                }
										
                                                if(p_this->alp_buff_zize >= ATSC3_ALP_HDR_SIZE ){
                                                        //collect alp finish, delivery	ALP 
                                                        ATSC3_ALP_DMX_DBG("delivery ALP { %02x.%02x.%02x.%02x }, alp len=%ld\n", p_this->alp_buffer[0], p_this->alp_buffer[1], p_this->alp_buffer[2], p_this->alp_buffer[3],p_this->alp_buff_zize);
                                                        p_this->cb.callback(p_this, 0x00, p_this->alp_buffer, 0, p_this->alp_buff_zize , 0x00, 0x00);
                                                        p_this->alp_buff_zize = 0;
                                                }
									
                                                if(alp_start_pointer!=0xB8){
                                                        //collect the next new ALP
                                                        ATSC3_ALP_DMX_DBG("collect the new first packet data ,data len :=%d\n", 184-alp_start_pointer);
                                                        memcpy(p_this->alp_buffer + p_this->alp_buff_zize, p_this->tsp_buffer+4+alp_start_pointer, 184-alp_start_pointer);
                                                        p_this->alp_buff_zize = p_this->alp_buff_zize +184-alp_start_pointer;
                                                }
                                        }
                                        p_this->tsp_excepted_size = 0;
                                        p_this->tsp_buff_size = 0;
                                
                                }

                        }
      
                }
                atsc3_alp_file_ring_release_data(p_rp_ori, len_ori, p_this->tp_id);
        }

        return 0;
}


int atsc3_alp_dmx_run(struct atsc3_alp_dmx* p_this)
{
        unsigned char *p_rp, *p_rp_ori;
        UINT32 len, len_ori;

        static int sync_byte_len = 3;

        ATSC3_ALP_DMX_TRACE();

        while (atsc3_alp_file_ring_read_data(&p_rp, &len, p_this->tp_id) == 0 && len) {
                p_rp_ori = p_rp;
                len_ori  = len;
                while(len > 0) {
                        ATSC3_ALP_DMX_DBG("read data from ring (%p) = { %02x.%02x.%02x.%02x....%02x.%02x.%02x.%02x }\n",
                                          p_rp,
                                          p_rp[0], p_rp[1], p_rp[2], p_rp[3],
                                          p_rp[len - 4], p_rp[len - 3], p_rp[len - 2], p_rp[len - 1]);
                        if (p_this->tsp_excepted_size == 0) {
                                // fid header header....
                                unsigned char* p_alp;
                                unsigned int   data_len;

                                if( (p_rp[1] == 0x00 || p_rp[1] == 0x40) && p_rp[2] == 0x00) {
                                        p_alp = p_rp;
                                } else {
                                        p_alp = atsc3_alp_find_starter(p_rp, len, sync_byte_len);
                                }

                                if (p_alp == NULL) {
                                        ATSC3_ALP_RELEASE_DATA(len);
                                        ATSC3_ALP_DMX_ERROR("alp re-sync 1 can not find sync byte p_rp=%p len=%d\n", p_rp, len);
                                        continue;
                                }

                                if (p_alp > p_rp) {
                                        // release spare data...
                                        data_len = (unsigned int)(p_alp - p_rp);
                                        ATSC3_ALP_RELEASE_DATA(data_len);
                                        ATSC3_ALP_DMX_ERROR("tlv re-sync 2 p_rp=%p len=%d data_len=%d\n", p_rp, len, data_len);
                                }

                                if (len < ATSC3_ALP_HDR_SIZE) { // data less than 4 bytes
                                        p_this->tsp_excepted_size = ATSC3_ALP_HDR_SIZE;
                                        memcpy(p_this->tsp_buffer, p_rp, len);      // store temp buffer
                                        p_this->tsp_buff_size     = len;            // minimum size...
                                        ATSC3_ALP_RELEASE_DATA(len);
                                } else {
                                        ATSC3_ALP_DMX_DBG("complete data block, just deliver it\n");
                                        // a complete data block : dispatch data directly

#ifdef USE_ALP_LIKE
                                        memcpy(p_this->alp_buffer + p_this->alp_buff_zize, p_rp, ATSC3_ALP_HDR_SIZE);
                                        p_this->alp_buff_zize = p_this->alp_buff_zize + ATSC3_ALP_HDR_SIZE;

                                        if(p_this->alp_buff_zize >= ATSC3_ALP_HDR_SIZE * 40) {
                                                p_this->cb.callback(p_this, 0x00, p_this->alp_buffer, 0, p_this->alp_buff_zize , 0x00, 0x00);
                                                p_this->alp_buff_zize = 0;
                                        }
#else
                                        if(p_rp[1] == 0x00 && p_rp[2] == 0x00 && ( (p_rp[3] & 0x20) == 0x20)) {
                                                if(p_this->alp_buff_zize != 0) {
                                                        unsigned char tsp_offset = 5 + p_rp[4];
                                                        memcpy(p_this->alp_buffer + p_this->alp_buff_zize, &p_rp[tsp_offset], ATSC3_ALP_HDR_SIZE - tsp_offset);
                                                        p_this->alp_buff_zize = p_this->alp_buff_zize + ATSC3_ALP_HDR_SIZE - tsp_offset;
                                                        p_this->cb.callback(p_this, p_rp[0], p_this->alp_buffer, 0, p_this->alp_buff_zize , 0x00, 0x00);
                                                        p_this->alp_buff_zize = 0;
                                                }
                                        } else if(p_rp[1] == 0x00 && p_rp[2] == 0x00 && ( (p_rp[3] & 0x20) == 0x00)) {
                                                if(p_this->alp_buff_zize != 0) {
                                                        memcpy(p_this->alp_buffer + p_this->alp_buff_zize, &p_rp[4], ATSC3_ALP_HDR_SIZE - 4);
                                                        p_this->alp_buff_zize = p_this->alp_buff_zize + (ATSC3_ALP_HDR_SIZE - 4);
                                                }
                                        } else if(p_rp[1] == 0x40 && p_rp[2] == 0x00 && ( (p_rp[3] & 0x20) == 0x00)) {
                                                if(p_this->alp_buff_zize != 0) {
                                                        p_this->cb.callback(p_this, p_rp[0], p_this->alp_buffer, 0, p_this->alp_buff_zize , 0x00, 0x00);
                                                }
                                                p_this->alp_buff_zize = 0;
                                                memcpy(p_this->alp_buffer + p_this->alp_buff_zize, &p_rp[4], ATSC3_ALP_HDR_SIZE - 4);
                                                p_this->alp_buff_zize = p_this->alp_buff_zize + (ATSC3_ALP_HDR_SIZE - 4);
                                        } else {
                                                p_this->alp_buff_zize = 0;
                                        }
#endif
                                        //ATSC3_ALP_DMX_ERROR("r#%d %d\n", __LINE__, ATSC3_ALP_HDR_SIZE);
                                        ATSC3_ALP_RELEASE_DATA(ATSC3_ALP_HDR_SIZE);
                                        p_this->tsp_excepted_size = 0;
                                        //ATSC3_ALP_DMX_ERROR("t_e_z =0 #%d\n", __LINE__);
                                        p_this->tsp_buff_size = 0;
                                }
                        } else if (p_this->tsp_excepted_size == ATSC3_ALP_HDR_SIZE) {
                                // collecting header....
                                if ( (len + p_this->tsp_buff_size) < ATSC3_ALP_HDR_SIZE) { // data less than 4 bytes
                                        memcpy(p_this->tsp_buffer + p_this->tsp_buff_size, p_rp, len);          // store temp buffer
                                        p_this->tsp_buff_size = p_this->tsp_buff_size + len;                        // minimum size...
                                        ATSC3_ALP_RELEASE_DATA(len);
                                } else {
                                        unsigned char process_size = ATSC3_ALP_HDR_SIZE - p_this->tsp_buff_size;
                                        memcpy(p_this->tsp_buffer + p_this->tsp_buff_size, p_rp, process_size);         // store temp buffer
                                        ATSC3_ALP_RELEASE_DATA(process_size);
#ifdef USE_ALP_LIKE
                                        memcpy(p_this->alp_buffer + p_this->alp_buff_zize, p_this->tsp_buffer, ATSC3_ALP_HDR_SIZE);
                                        p_this->alp_buff_zize = p_this->alp_buff_zize + ATSC3_ALP_HDR_SIZE;

                                        if(p_this->alp_buff_zize >= ATSC3_ALP_HDR_SIZE * 40) {
                                                p_this->cb.callback(p_this, 0x00, p_this->alp_buffer, 0, p_this->alp_buff_zize , 0x00, 0x00);
                                                p_this->alp_buff_zize = 0;
                                        }

                                        p_this->tsp_excepted_size = 0;
                                        p_this->tsp_buff_size = 0;
#else
                                        p_this->tsp_excepted_size = 0;
                                        p_this->tsp_buff_size = 0;

                                        if(p_this->tsp_buffer[1] == 0x00 && p_this->tsp_buffer[2] == 0x00 && ( (p_this->tsp_buffer[3] & 0x20) == 0x20)) {
                                                unsigned char tsp_offset = 5 + p_this->tsp_buffer[4];
                                                memcpy(p_this->alp_buffer + p_this->alp_buff_zize, &p_this->tsp_buffer[tsp_offset], ATSC3_ALP_HDR_SIZE - tsp_offset);
                                                p_this->alp_buff_zize = p_this->alp_buff_zize + ATSC3_ALP_HDR_SIZE - tsp_offset;
                                                p_this->cb.callback(p_this, p_this->tsp_buffer[0], p_this->alp_buffer, 0, p_this->alp_buff_zize , 0x00, 0x00);
                                                p_this->alp_buff_zize = 0;
                                        } else if(p_this->tsp_buffer[1] == 0x00 && p_this->tsp_buffer[2] == 0x00 && ( (p_this->tsp_buffer[3] & 0x20) == 0x00)) {
                                                memcpy(p_this->alp_buffer + p_this->alp_buff_zize, &p_this->tsp_buffer[4], ATSC3_ALP_HDR_SIZE - 4);
                                                p_this->alp_buff_zize = p_this->alp_buff_zize + (ATSC3_ALP_HDR_SIZE - 4);
                                        } else if(p_this->tsp_buffer[1] == 0x40 && p_this->tsp_buffer[2] == 0x00 && ( (p_this->tsp_buffer[3] & 0x20) == 0x00)) {
                                                p_this->alp_buff_zize = 0;
                                                memcpy(p_this->alp_buffer + p_this->alp_buff_zize, &p_this->tsp_buffer[4], ATSC3_ALP_HDR_SIZE - 4);
                                                p_this->alp_buff_zize = p_this->alp_buff_zize + (ATSC3_ALP_HDR_SIZE - 4);
                                        } else {
                                                p_this->alp_buff_zize = 0;
                                        }
#endif
                                }
                        }
                }
                atsc3_alp_file_ring_release_data(p_rp_ori, len_ori, p_this->tp_id);
        }

        return 0;
}

/*======================================================
 * Func  : create_atsc3_alp_dmx
 *
 * Desc  : create a atsc3_alp demux
 *
 * Param : p_dmx_in : input buffer
 *
 * Retn  : handle of atsc3_alp dmx
 *======================================================*/
struct atsc3_alp_dmx* create_atsc3_alp_dmx(
        struct atsc3_alp_dmx_callback*            p_cb,
        unsigned char   tp_id
)
{
        struct atsc3_alp_dmx* p_this;

        ATSC3_ALP_DMX_TRACE();

        p_this = (struct atsc3_alp_dmx*) atsc3_alp_dmx_malloc(sizeof(struct atsc3_alp_dmx));

        if (p_this) {
                memset(p_this, 0, sizeof(struct atsc3_alp_dmx));
                p_this->cb = *p_cb;
                p_this->ops.start = atsc3_alp_dmx_start;
                p_this->ops.stop  = atsc3_alp_dmx_stop;
                p_this->ops.run   = atsc3_alp_dmx_run_sony;
                p_this->tp_id = tp_id;
        }

        return p_this;
}

/*======================================================
 * Func  : destroy_atsc3_alp_dmx
 *
 * Desc  :
 *
 * Param : handle of atsc3_alp dmx
 *
 * Retn  : N/A
 *======================================================*/
void destroy_atsc3_alp_dmx(struct atsc3_alp_dmx* p_this)
{
        ATSC3_ALP_DMX_TRACE();
        if (p_this)
                atsc3_alp_dmx_free(p_this);
}

/*======================================================
 * Func  : atsc3_alp_file_ring_read_data
 *
 * Desc  :
 *
 * Param :
 *
 * Retn  : N/A
 *======================================================*/
//#define ALP_188_STATIC_TEST 1
 #ifdef ALP_188_STATIC_TEST
static unsigned char testdata[] = {
	0xA3,0x6E,0x00,0x2D,0xA4,0xD0,0xA0,0x10,0x6A,0x7D,0x97,0xCA,0xDF,0x68,0xE5,0x9B,0xA9,0x35,0x67,0x86,
	0x47,0x00,0x2D,0x04,0xD8,0x81,0x70,0x3A,0x90,0x18,0xFA,0x44,0xFE,0x93,0xAF,0x4C,0xE5,0x96,0xB8,0xDE,0x68,0x35,0x05,0xB6,0xB7,0x40,0xF3,0x66,0x54,0xE6,0x3D,0x96,0xC6,0x1D,0x29,0x40,0xBA,0xBC,0x14,0x52,0xF7,0x88,0x65,0x38,0xC6,0xC0,0xDF,0xEC,0x27,0x67,0xD7,0x83,0x66,0xE3,0x8B,0xCC,0xBF,0xB9,0x09,0x1D,0x36,0xA7,0xF9,0xBC,0x86,0x45,0x41,0xF4,0xC3,0x14,0x60,0xCB,0x2B,0xE5,0xA1,0xD9,0x30,0x14,0xC9,0x91,0x7F,0x31,0x61,0x6A,0xFB,0x98,0x08,0xE4,0x7C,0x81,0x1A,0x0D,0xCC,0x87,0x33,0xF3,0xEB,0xD6,0xEF,0xAC,0x1C,0xDF,0xB7,0xAB,0x00,0xBB,0x36,0x7C,0x43,0x0E,0xFC,0x45,0x93,0x89,0xD7,0xB6,0x73,0x41,0xC1,0x2E,0x5D,0x44,0xAD,0xF3,0x62,0x91,0xCB,0x33,0x4D,0x10,0x3A,0x90,0x43,0x0E,0xEB,0x7D,0x1B,0xD3,0xAA,0x57,0x44,0xBD,0xBA,0x25,0xE3,0x61,0x0B,0xF9,0xAB,0x9B,0x5A,0xFF,0xE5,0x6F,0xAE,0x6D,0x5E,0x1A,0x51,0x04,0x93,0xC8,0x0C,0x25,0x54,0x31,0x20,0x75,0xEC,0xD2,0x40,0x7C,0x9E,0xF2,0x18,0x51,0x03,0x8D,0x97,0xF7,0xCB,0xFF,0xC3,0x51,0xCC,0xE1,0x56,0xFD,
	0x47,0x40,0x2D,0xA1,0xC1,0x75,0x2B,0x59,0x2E,0x71,0x11,0x0D,0xC5,0x5A,0xB9,0xAB,0x97,0x61,0x9F,0x3D,0xF8,0xE1,0xB6,0x6C,0x37,0x5B,0x4F,0x73,0x1E,0xE0,0x56,0x63,0x24,0xCA,0xF2,0xD5,0x83,0x2B,0xD0,0x6E,0x60,0xE0,0xCA,0x82,0xB4,0x15,0xCB,0xE1,0x19,0x07,0xFF,0x22,0x95,0x93,0x8E,0xC2,0x3A,0x91,0xE6,0x6C,0x8B,0xEA,0xD2,0x95,0x80,0xE9,0x59,0x3F,0x3F,0xB7,0x80,0x59,0xCD,0x78,0x17,0x83,0xB4,0xB5,0x43,0xD0,0x34,0x69,0xE4,0x80,0xB5,0xA5,0x86,0x10,0x76,0xC9,0x60,0x14,0x8A,0xA7,0x18,0x4D,0xD4,0x2B,0xEB,0xC3,0x4A,0x00,0x0D,0x0F,0x15,0x79,0xC5,0xBC,0x73,0x3A,0x27,0x83,0x56,0x8D,0x09,0xAD,0x55,0x6C,0x30,0x13,0x5C,0x43,0xBB,0xB3,0x69,0x71,0xA8,0xCA,0x4F,0x2D,0x7C,0xB4,0xDC,0x26,0x6C,0x9E,0x5F,0x65,0x3F,0xFC,0xB1,0x9C,0x69,0xB5,0x49,0x9A,0x68,0x8A,0xA5,0x20,0x7D,0xE3,0xC6,0x4B,0xA5,0xDC,0x3D,0x18,0x44,0x3E,0x7C,0xA0,0xF8,0xB8,0x8F,0x05,0xDC,0x45,0x00,0x05,0xDC,0x62,0xB3,0x40,0x00,0x20,0x11,0xDD,0x3F,0x0A,0x14,0x01,0x0A,0xEF,0xFF,0x1A,0x01,0xDE,
	0x47,0x00,0x2D,0xCF,0x0A,0x29,0x05,0xC8,0x8F,0x91,0x12,0xA0,0x05,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0A,0x00,0x0A,0x1A,0x0D,0xC2,0x10,0x27,0x9A,0x00,0x0D,0x09,0x30,0x34,0x3A,0x36,0x77,0x8F,0x2F,0xE1,0xE8,0x61,0x73,0xAC,0xCD,0x09,0x3F,0x43,0xB5,0x8A,0x3D,0x22,0x59,0x6A,0xCE,0xC4,0x24,0xDA,0x8A,0xD4,0x75,0x74,0x4B,0x9B,0x64,0x8A,0x7D,0x08,0x67,0xA6,0x9C,0xA7,0xC5,0x48,0x50,0xAD,0x76,0x37,0x74,0x0A,0xFB,0x86,0x22,0xE2,0x1C,0xDF,0xD2,0x98,0x52,0x05,0x25,0x83,0x2A,0x03,0x35,0x47,0xCF,0x56,0x0F,0xE0,0x92,0x1F,0x7F,0x3B,0xB2,0xE2,0xDF,0x71,0xD9,0x5D,0xCF,0x69,0xFB,0x5E,0x00,0xBB,0x0B,0x94,0xE7,0xE0,0x01,0xEC,0x9B,0x91,0xF4,0xF3,0x40,0xD8,0x5C,0xA9,0xA8,0xD4,0x0B,0x75,0x0A,0x04,0x14,0x89,0x17,0x6E,0x12,0xE6,0xC7,0xE2,0xC9,0xA5,0x55,0xB5,0x6F,0x1F,0x6E,0xCC,0x40,0xA1,0x8E,0x6D,0xCB,0x17,0xF9,0x3E,0x76,0x13,0x15,0x34,0xA5,0x79,0xE5,0xB9,0xBF,0x53,0xDA,0x1F,0xA6,0xE6,0x18,0x2E,0xB1,0x35,0x96,0xA8,0xFF,0x2F,0x21,0x4D,0xCF,0x62,0x31,
	0x47,0x00,0x2D,0x5E,0xFD,0x46,0x48,0xB8,0xCC,0xCF,0x30,0xCE,0x36,0xD6,0x38,0xD2,0xF2,0x3A,0xE8,0xCF,0xD9,0xE4,0xC3,0xC4,0xCB,0x0F,0x91,0x4E,0xCE,0x03,0xD9,0xA4,0x8C,0x1D,0x42,0x12,0x80,0xF2,0xAC,0x84,0x9F,0x0F,0x21,0xF3,0x9C,0xC7,0xBC,0xA0,0x28,0xD9,0x3C,0x3E,0xF1,0x99,0x50,0x2F,0xBB,0xE8,0x30,0xB3,0x39,0xA0,0x48,0x74,0x9F,0x20,0x4A,0xF3,0xCE,0x1A,0x17,0x2B,0xDD,0xDC,0x49,0xD4,0x50,0x4A,0xFE,0x2F,0x61,0xBB,0xD4,0x60,0xEF,0x34,0xDE,0x1B,0x24,0xE3,0xAF,0x9F,0xB4,0x0F,0x00,0x08,0x5F,0xA5,0x82,0x3F,0xDB,0xD3,0xD4,0xB3,0xDF,0x47,0x8C,0xB7,0x14,0xB7,0xB4,0xC7,0xE8,0x19,0x8A,0xF5,0xBC,0x96,0x23,0x05,0x0D,0x18,0xA3,0xC0,0x5F,0xE2,0x12,0xE7,0x65,0xA4,0x9F,0x95,0xCB,0x32,0xE1,0xE7,0x40,0x22,0x60,0x01,0x7D,0x92,0xF0,0xD5,0xE1,0x0D,0xF2,0x8F,0xDB,0x9B,0xD7,0x51,0x88,0x89,0x87,0x17,0xB4,0xAA,0x60,0xF1,0xB7,0x98,0xA8,0xC6,0x2E,0x3E,0x3E,0xBE,0x2C,0x49,0xB7,0x1B,0x98,0x1C,0xDA,0xF5,0x41,0x9D,0x09,0x27,0x6B,0x8F,0x20,0x77,0xE4,0x9A,0xBC,0x52,
	0x47,0x00,0x2D,0x1A,0x47,0xFA,0xC7,0x2C,0x2D,0xF9,0x61,0xCF,0xF9,0x70,0xD3,0x2E,0x18,0xDC,0x52,0x14,0xAB,0xF0,0xE9,0xF6,0xAE,0xCF,0xE5,0xCC,0xD2,0x83,0xE9,0xF4,0xC5,0x2D,0x27,0x42,0x09,0xA5,0x13,0xF3,0x5B,0xF2,0x5F,0x8E,0x60,0x78,0xB0,0x90,0x64,0xDB,0xB3,0x22,0xFA,0xDB,0xC0,0xE7,0x67,0x5C,0x5B,0x18,0x2E,0x56,0x87,0x32,0x6C,0x91,0xEB,0x25,0x98,0xBD,0x97,0x3C,0x2A,0xDA,0x42,0xFA,0x61,0x59,0x6B,0xA5,0x27,0x70,0x78,0x6B,0x00,0xF3,0xA7,0x22,0x28,0x5B,0xE3,0x7B,0x3E,0xAD,0x54,0x0E,0x25,0x90,0x4A,0x7D,0x91,0x0F,0x51,0x6D,0xA0,0x04,0x06,0x4F,0x76,0x1C,0x1D,0x39,0xC0,0xD7,0x25,0xBF,0x67,0x0F,0xEE,0xED,0xEF,0xEF,0xF8,0xBF,0x24,0x5A,0x9E,0x8D,0x50,0x32,0xA9,0xB9,0xDD,0xAC,0x32,0xD4,0x0A,0x64,0x1B,0x1A,0x3E,0xB6,0x79,0xC5,0xDD,0x6E,0xFC,0x1B,0x7E,0x87,0xC1,0x1D,0x09,0x5F,0x65,0x7F,0x15,0x79,0x39,0x66,0x23,0x3E,0x6B,0x7E,0x1C,0xE4,0xD5,0xF6,0x4A,0x52,0x8A,0x33,0xE1,0x10,0x4C,0x60,0x7B,0x48,0xD6,0x9D,0xAC,0xF8,0x89,0xF0,0x81,0x8A,0x09,0x90,
	0x47,0x00,0x2D,0x9B,0x53,0x01,0xF1,0x28,0xE1,0xDE,0x57,0x29,0x7E,0x5B,0x2F,0x33,0x9B,0xE4,0x8B,0xE5,0x78,0xB2,0xE6,0x87,0x5C,0xE2,0x62,0xF2,0xD0,0x15,0xA8,0xB9,0x6F,0x21,0x77,0x7C,0x6C,0xF2,0x2C,0xA5,0xAE,0xA7,0xAC,0x08,0x64,0xAB,0x7B,0x08,0x11,0xF9,0x6F,0x92,0xEC,0x93,0x6A,0x1F,0x77,0x80,0x86,0x4A,0xD2,0xF7,0xAA,0xB2,0x32,0x47,0x63,0x0F,0x57,0xE3,0xD3,0x9C,0x07,0xAB,0x1A,0x59,0x2D,0xB9,0x62,0x64,0x21,0x3B,0x68,0xB0,0x90,0x53,0x34,0xD1,0x86,0xA7,0x14,0x6C,0x03,0xC4,0x46,0x43,0x26,0x48,0x9C,0xCF,0xB1,0x07,0xEB,0xA0,0xC8,0x69,0xDF,0x54,0x87,0xD1,0x69,0x19,0x7E,0xFD,0x85,0x15,0x29,0x9F,0x35,0xFB,0x3C,0x08,0x55,0xFD,0xD1,0x41,0xBC,0xA0,0x97,0x67,0xF6,0x7A,0x62,0xF4,0xE8,0x01,0x06,0x51,0xB5,0x96,0x8B,0x55,0x0E,0x6A,0xD1,0x8B,0x08,0x3F,0xE7,0xD4,0xFF,0x43,0x0D,0x8B,0x73,0x74,0x93,0xE9,0x81,0xD0,0x92,0x31,0xFD,0x28,0x4D,0x61,0x59,0xF9,0x78,0x1D,0x81,0xE0,0x10,0xF9,0xD9,0x48,0x83,0x53,0x91,0x6C,0x3F,0xDA,0xAC,0x0A,0x61,0x9D,0xC5,0x41,
	0x47,0x00,0x2D,0x3B,0xBF,0xB1,0xA1,0x5C,0x23,0xFD,0x63,
	//0x17,0x33,0xC3,0x90,0x22,0xAC,0x18,0xB0,0x45,0x3B,0x25,0x50,0x97,0x07,0x44,0xA5,0xC9,0x8D,0x3B,0xFD,0x04,0xF6,0x61,0x88,0xF1,0xF2,0x32,0x01,0xD9,0xEC,0x82,0xD7,0x61,0x39,0x4D,0x01,0xC9,0x12,0xDF,0x06,0xDA,0xEE,0xB6,0x77,0xFD,0x53,0x42,0xAE,0x28,0x55,0xD4,0xF1,0xB9,0x7B,0x6A,0x6C,0x9A,0xCB,0xA8,0x74,0x2F,0xEC,0x37,0x7E,0x93,0x1B,0xCB,0x56,0xF6,0x17,0x5D,0xAF,0xD6,0xC1,0xFF,0x54,0x48,0x52,0x4D,0x10,0x01,0xAD,0x00,0x1D,0x86,0xCF,0x47,0xA9,0x72,0x2C,0x47,0x2B,0x1A,0x1A,0xC9,0x57,0xEC,0xF5,0xBE,0x7A,0x87,0x4B,0x3D,0x66,0x56,0x4C,0xF9,0xD8,0x63,0xBF,0x1C,0x14,0x0C,0xB4,0xED,0xDE,0x4F,0x3D,0x1D,0x2D,0xE8,0xDD,0xC2,0xB1,0xB9,0x8B,0x76,0x63,0x13,0x23,0xFC,0x42,0x70,0xD7,0x29,0xD2,0xAB,0x10,0x0E,0x70,0x71,0x1F,0x35,0xFA,0xBD,0xDC,0x89,0xAC,0x62,0x73,0xEC,0x5F,0x42,0x99,0x1D,0x54,0xBB,0x1E,0x75,0x9E,0x62,0x16,0xF1,0xC7,0x40,0x3F,0xF8,0x04,0x7D,0x7F,0xE0,0x71,0x4C,0x4D,0x4B,0xD3,0xE1,
	//0x47,0x00,0x2D,0x47,0x63,0x77,0x60,0x3B,0xED,0x51,0xD6,0x7B,0x6A,0xFC,0x71,0x72,0xE9,0xE9,0x6B,0x03,0xCC,0x4A,0xA3,0xD4,0x02,0x3A,0x42,0xF3,0x82,0x59,0xD2,0xB0,0xED,0xD6,0xA0,0x46,0xFE,0x60,0x52,0x81,0xAF,0x17,0x10,0x74,0xFD,0x11,0xBC,0x73,0xDE,0x61,0x26,0x32,0x0E,0xCF,0xB5,0x7D,0x70,0xB1,0xC3,0xB4,0x9B,0x5C,0x38,0x29,0x2A,0xF0,0x77,0x57,0x8E,0x3E,0xFF,0xD8,0x3E,0xA5,0xB5,0x7B,0xD7,0x44,0x0E,0x70,0xB9,0x45,0x5D,0xAA,0x45,0x70,0xEB,0xA5,0xF6,0xA9,0xA3,0x3B,0x35,0xAB,0x11,0x49,0xD6,0xEA,0xED,0xA8,0x14,0xB3,0x3F,0xA9,0x6D,0x79,0x22,0xAE,0x7B,0x31,0x7F,0x04,0xE5,0xBC,0xCB,0xA6,0x9D,0xDA,0xA5,0x83,0x00,0xB1,0x99,0x0A,0xCF,0x55,0x3F,0x30,0x05,0x4B,0x32,0x2A,0xDA,0x6F,0xD1,0x1B,0xAB,0xE7,0x45,0x5A,0xA1,0xF0,0x59,0x44,0x89,0x8C,0x6D,0x90,0x68,0x4B,0xD0,0x2F,0x75,0x3F,0xB5,0x1C,0x30,0x1F,0x4D,0xA8,0x47,0xF3,0x19,0xCC,0x18,0xA3,0x04,0xA7,0xAE,0x42,0x22,0x3B,0x7E,0xE3,0x6C,0xE1,0x38,0xE7,0x2B,0xBE,0x58,0xC5,0x0B,0xEE,0x4D,0x8A,0x30,0xDF,
	//0x47,0x00,0x2D,0x71,0xE0,0xB1,0x64,0x1E,0x7E,0x70,0x3E,0x4A,0xBD,0x5B,0xBB,0x23,0x0C,0x65,0x32,0xDC,0x47,0x9B,0xFD,0xFF,0x5C,0xD2,0x04,0xEF,0xA0,0x15,0x2A,0x5F,0x0C,0x8C,0xDE,0xF1,0xEB,0xEC,0xD1,0xAF,0x8D,0xEC,0x1E,0x05,0x3B,0x9B,0xD4,0x55,0xB5,0x86,0xA6,0x04,0x0C,0x29,0x04,0xE1,0x32,0x96,0x39,0xAC,0x6F,0x09,0xF6,0x65,0xEA,0x92,0xC3,0xD1,0xC0,0x7F,0x50,0x40,0xDE,0xC4,0x5E,0x70,0x46,0x2F,0x63,0x30,0xDC,0x09,0x99,0x7D,0x16,0x7E,0xD1,0x76,0xC8,0x82,0xC3,0xD2,0xEE,0x68,0x40,0x15,0x31,0x67,0x8F,0x3B,0x48,0x04,0x05,0xF6,0x5F,0x0D,0x48,0xB0,0x19,0x7F,0xEE,0x3A,0xC1,0x17,0xF9,0xA1,0x41,0xC5,0xD7,0x73,0xC8,0x27,0x19,0x32,0x60,0xA2,0xA4,0x5D,0x86,0x0D,0x81,0x59,0x1B,0x04,0x00,0xB5,0xA2,0x2B,0x48,0x81,0x68,0x40,0x37,0x11,0x70,0x39,0xDF,0xAF,0x18,0x06,0x16,0x4E,0xB8,0x8A,0xA8,0x45,0x73,0x1B,0xA2,0xB2,0x55,0x6E,0x6D,0x3C,0xA8,0xE9,0xD5,0x9D,0x18,0x4B,0x1A,0xEC,0x22,0x67,0x4C,0x6F,0xD6,0xB6,0xD5,0xDE,0x5B,0x50,0xF6,0x5B,0x5D,0xE6,0x5B,0xC4,
	//0x47,0x40,0x2D,0xB8,0xF7,0xCF,0xFF,0x33,0x2C,0x3E,0x9C,0x3D,0xD4,0xDF,0x4E,0x15,0x2B,0x39,0x4C,0x00,0xDA,0x4B,0xC5,0xB1,0xA8,0x99,0xBE,0x1E,0xF6,0x0F,0x07,0x83,0x71,0x24,0x51,0x2D,0xE7,0x3C,0x01,0x95,0x3C,0x59,0xB3,0x58,0xD0,0xCB,0x3B,0x80,0x54,0xF5,0xAD,0x5E,0x40,0x6F,0x7B,0x36,0x40,0xF4,0x5F,0xF5,0x5D,0x01,0xAE,0xC2,0x26,0x7D,0x5A,0x66,0x00,0x2B,0xE5,0x75,0x49,0x7C,0x8A,0xA9,0xA4,0xFE,0x06,0x71,0xE0,0x39,0x01,0xBB,0xAE,0xB1,0x1E,0x3F,0x5E,0xEB,0x37,0x68,0x5E,0xEB,0x82,0xD9,0x34,0x28,0xB6,0x24,0xEC,0x0E,0x88,0x9F,0xA8,0x1D,0xF0,0x33,0xDF,0x8A,0x64,0x73,0xF0,0x59,0x43,0x42,0xDF,0x34,0xAE,0x5A,0x93,0xDD,0xAC,0x6D,0x29,0x98,0xDE,0x62,0x7F,0x6F,0xA1,0x86,0x80,0x6A,0xBE,0xF9,0x1D,0x83,0x69,0x6D,0x87,0x51,0xE2,0xD5,0xC8,0xD2,0x05,0x4D,0xE4,0x10,0x97,0x77,0x31,0x4F,0x34,0x9F,0xDD,0x60,0xD0,0xEF,0x02,0xFC,0xDF,0x37,0x09,0x46,0xD0,0x6C,0x69,0x73,0x88,0xCF,0xE1,0x7B,0x55,0xA2,0xC0,0xA6,0x03,0x31,0xCF,0x58,0xB6,0xFE,0xEE,0xEE,0xEF,0x91,
	//0x47,0x40,0x2D,0x00,0x05,0xDC,0x45,0x00,0x05,0xDC,0x62,0xB5,0x40,0x00,0x20,0x11,0xDD,0x3D,0x0A,0x14
};

static unsigned char testdata2[] = {
	//0xA3,0x6E,0x00,0x2D,0xA4,0xD0,0xA0,0x10,0x6A,0x7D,0x97,0xCA,0xDF,0x68,0xE5,0x9B,0xA9,0x35,0x67,0x86,
	//0x47,0x00,0x2D,0x04,0xD8,0x81,0x70,0x3A,0x90,0x18,0xFA,0x44,0xFE,0x93,0xAF,0x4C,0xE5,0x96,0xB8,0xDE,0x68,0x35,0x05,0xB6,0xB7,0x40,0xF3,0x66,0x54,0xE6,0x3D,0x96,0xC6,0x1D,0x29,0x40,0xBA,0xBC,0x14,0x52,0xF7,0x88,0x65,0x38,0xC6,0xC0,0xDF,0xEC,0x27,0x67,0xD7,0x83,0x66,0xE3,0x8B,0xCC,0xBF,0xB9,0x09,0x1D,0x36,0xA7,0xF9,0xBC,0x86,0x45,0x41,0xF4,0xC3,0x14,0x60,0xCB,0x2B,0xE5,0xA1,0xD9,0x30,0x14,0xC9,0x91,0x7F,0x31,0x61,0x6A,0xFB,0x98,0x08,0xE4,0x7C,0x81,0x1A,0x0D,0xCC,0x87,0x33,0xF3,0xEB,0xD6,0xEF,0xAC,0x1C,0xDF,0xB7,0xAB,0x00,0xBB,0x36,0x7C,0x43,0x0E,0xFC,0x45,0x93,0x89,0xD7,0xB6,0x73,0x41,0xC1,0x2E,0x5D,0x44,0xAD,0xF3,0x62,0x91,0xCB,0x33,0x4D,0x10,0x3A,0x90,0x43,0x0E,0xEB,0x7D,0x1B,0xD3,0xAA,0x57,0x44,0xBD,0xBA,0x25,0xE3,0x61,0x0B,0xF9,0xAB,0x9B,0x5A,0xFF,0xE5,0x6F,0xAE,0x6D,0x5E,0x1A,0x51,0x04,0x93,0xC8,0x0C,0x25,0x54,0x31,0x20,0x75,0xEC,0xD2,0x40,0x7C,0x9E,0xF2,0x18,0x51,0x03,0x8D,0x97,0xF7,0xCB,0xFF,0xC3,0x51,0xCC,0xE1,0x56,0xFD,
	//0x47,0x40,0x2D,0xA1,0xC1,0x75,0x2B,0x59,0x2E,0x71,0x11,0x0D,0xC5,0x5A,0xB9,0xAB,0x97,0x61,0x9F,0x3D,0xF8,0xE1,0xB6,0x6C,0x37,0x5B,0x4F,0x73,0x1E,0xE0,0x56,0x63,0x24,0xCA,0xF2,0xD5,0x83,0x2B,0xD0,0x6E,0x60,0xE0,0xCA,0x82,0xB4,0x15,0xCB,0xE1,0x19,0x07,0xFF,0x22,0x95,0x93,0x8E,0xC2,0x3A,0x91,0xE6,0x6C,0x8B,0xEA,0xD2,0x95,0x80,0xE9,0x59,0x3F,0x3F,0xB7,0x80,0x59,0xCD,0x78,0x17,0x83,0xB4,0xB5,0x43,0xD0,0x34,0x69,0xE4,0x80,0xB5,0xA5,0x86,0x10,0x76,0xC9,0x60,0x14,0x8A,0xA7,0x18,0x4D,0xD4,0x2B,0xEB,0xC3,0x4A,0x00,0x0D,0x0F,0x15,0x79,0xC5,0xBC,0x73,0x3A,0x27,0x83,0x56,0x8D,0x09,0xAD,0x55,0x6C,0x30,0x13,0x5C,0x43,0xBB,0xB3,0x69,0x71,0xA8,0xCA,0x4F,0x2D,0x7C,0xB4,0xDC,0x26,0x6C,0x9E,0x5F,0x65,0x3F,0xFC,0xB1,0x9C,0x69,0xB5,0x49,0x9A,0x68,0x8A,0xA5,0x20,0x7D,0xE3,0xC6,0x4B,0xA5,0xDC,0x3D,0x18,0x44,0x3E,0x7C,0xA0,0xF8,0xB8,0x8F,0x05,0xDC,0x45,0x00,0x05,0xDC,0x62,0xB3,0x40,0x00,0x20,0x11,0xDD,0x3F,0x0A,0x14,0x01,0x0A,0xEF,0xFF,0x1A,0x01,0xDE,
	//0x47,0x00,0x2D,0xCF,0x0A,0x29,0x05,0xC8,0x8F,0x91,0x12,0xA0,0x05,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0A,0x00,0x0A,0x1A,0x0D,0xC2,0x10,0x27,0x9A,0x00,0x0D,0x09,0x30,0x34,0x3A,0x36,0x77,0x8F,0x2F,0xE1,0xE8,0x61,0x73,0xAC,0xCD,0x09,0x3F,0x43,0xB5,0x8A,0x3D,0x22,0x59,0x6A,0xCE,0xC4,0x24,0xDA,0x8A,0xD4,0x75,0x74,0x4B,0x9B,0x64,0x8A,0x7D,0x08,0x67,0xA6,0x9C,0xA7,0xC5,0x48,0x50,0xAD,0x76,0x37,0x74,0x0A,0xFB,0x86,0x22,0xE2,0x1C,0xDF,0xD2,0x98,0x52,0x05,0x25,0x83,0x2A,0x03,0x35,0x47,0xCF,0x56,0x0F,0xE0,0x92,0x1F,0x7F,0x3B,0xB2,0xE2,0xDF,0x71,0xD9,0x5D,0xCF,0x69,0xFB,0x5E,0x00,0xBB,0x0B,0x94,0xE7,0xE0,0x01,0xEC,0x9B,0x91,0xF4,0xF3,0x40,0xD8,0x5C,0xA9,0xA8,0xD4,0x0B,0x75,0x0A,0x04,0x14,0x89,0x17,0x6E,0x12,0xE6,0xC7,0xE2,0xC9,0xA5,0x55,0xB5,0x6F,0x1F,0x6E,0xCC,0x40,0xA1,0x8E,0x6D,0xCB,0x17,0xF9,0x3E,0x76,0x13,0x15,0x34,0xA5,0x79,0xE5,0xB9,0xBF,0x53,0xDA,0x1F,0xA6,0xE6,0x18,0x2E,0xB1,0x35,0x96,0xA8,0xFF,0x2F,0x21,0x4D,0xCF,0x62,0x31,
	//0x47,0x00,0x2D,0x5E,0xFD,0x46,0x48,0xB8,0xCC,0xCF,0x30,0xCE,0x36,0xD6,0x38,0xD2,0xF2,0x3A,0xE8,0xCF,0xD9,0xE4,0xC3,0xC4,0xCB,0x0F,0x91,0x4E,0xCE,0x03,0xD9,0xA4,0x8C,0x1D,0x42,0x12,0x80,0xF2,0xAC,0x84,0x9F,0x0F,0x21,0xF3,0x9C,0xC7,0xBC,0xA0,0x28,0xD9,0x3C,0x3E,0xF1,0x99,0x50,0x2F,0xBB,0xE8,0x30,0xB3,0x39,0xA0,0x48,0x74,0x9F,0x20,0x4A,0xF3,0xCE,0x1A,0x17,0x2B,0xDD,0xDC,0x49,0xD4,0x50,0x4A,0xFE,0x2F,0x61,0xBB,0xD4,0x60,0xEF,0x34,0xDE,0x1B,0x24,0xE3,0xAF,0x9F,0xB4,0x0F,0x00,0x08,0x5F,0xA5,0x82,0x3F,0xDB,0xD3,0xD4,0xB3,0xDF,0x47,0x8C,0xB7,0x14,0xB7,0xB4,0xC7,0xE8,0x19,0x8A,0xF5,0xBC,0x96,0x23,0x05,0x0D,0x18,0xA3,0xC0,0x5F,0xE2,0x12,0xE7,0x65,0xA4,0x9F,0x95,0xCB,0x32,0xE1,0xE7,0x40,0x22,0x60,0x01,0x7D,0x92,0xF0,0xD5,0xE1,0x0D,0xF2,0x8F,0xDB,0x9B,0xD7,0x51,0x88,0x89,0x87,0x17,0xB4,0xAA,0x60,0xF1,0xB7,0x98,0xA8,0xC6,0x2E,0x3E,0x3E,0xBE,0x2C,0x49,0xB7,0x1B,0x98,0x1C,0xDA,0xF5,0x41,0x9D,0x09,0x27,0x6B,0x8F,0x20,0x77,0xE4,0x9A,0xBC,0x52,
	//0x47,0x00,0x2D,0x1A,0x47,0xFA,0xC7,0x2C,0x2D,0xF9,0x61,0xCF,0xF9,0x70,0xD3,0x2E,0x18,0xDC,0x52,0x14,0xAB,0xF0,0xE9,0xF6,0xAE,0xCF,0xE5,0xCC,0xD2,0x83,0xE9,0xF4,0xC5,0x2D,0x27,0x42,0x09,0xA5,0x13,0xF3,0x5B,0xF2,0x5F,0x8E,0x60,0x78,0xB0,0x90,0x64,0xDB,0xB3,0x22,0xFA,0xDB,0xC0,0xE7,0x67,0x5C,0x5B,0x18,0x2E,0x56,0x87,0x32,0x6C,0x91,0xEB,0x25,0x98,0xBD,0x97,0x3C,0x2A,0xDA,0x42,0xFA,0x61,0x59,0x6B,0xA5,0x27,0x70,0x78,0x6B,0x00,0xF3,0xA7,0x22,0x28,0x5B,0xE3,0x7B,0x3E,0xAD,0x54,0x0E,0x25,0x90,0x4A,0x7D,0x91,0x0F,0x51,0x6D,0xA0,0x04,0x06,0x4F,0x76,0x1C,0x1D,0x39,0xC0,0xD7,0x25,0xBF,0x67,0x0F,0xEE,0xED,0xEF,0xEF,0xF8,0xBF,0x24,0x5A,0x9E,0x8D,0x50,0x32,0xA9,0xB9,0xDD,0xAC,0x32,0xD4,0x0A,0x64,0x1B,0x1A,0x3E,0xB6,0x79,0xC5,0xDD,0x6E,0xFC,0x1B,0x7E,0x87,0xC1,0x1D,0x09,0x5F,0x65,0x7F,0x15,0x79,0x39,0x66,0x23,0x3E,0x6B,0x7E,0x1C,0xE4,0xD5,0xF6,0x4A,0x52,0x8A,0x33,0xE1,0x10,0x4C,0x60,0x7B,0x48,0xD6,0x9D,0xAC,0xF8,0x89,0xF0,0x81,0x8A,0x09,0x90,
	//0x47,0x00,0x2D,0x9B,0x53,0x01,0xF1,0x28,0xE1,0xDE,0x57,0x29,0x7E,0x5B,0x2F,0x33,0x9B,0xE4,0x8B,0xE5,0x78,0xB2,0xE6,0x87,0x5C,0xE2,0x62,0xF2,0xD0,0x15,0xA8,0xB9,0x6F,0x21,0x77,0x7C,0x6C,0xF2,0x2C,0xA5,0xAE,0xA7,0xAC,0x08,0x64,0xAB,0x7B,0x08,0x11,0xF9,0x6F,0x92,0xEC,0x93,0x6A,0x1F,0x77,0x80,0x86,0x4A,0xD2,0xF7,0xAA,0xB2,0x32,0x47,0x63,0x0F,0x57,0xE3,0xD3,0x9C,0x07,0xAB,0x1A,0x59,0x2D,0xB9,0x62,0x64,0x21,0x3B,0x68,0xB0,0x90,0x53,0x34,0xD1,0x86,0xA7,0x14,0x6C,0x03,0xC4,0x46,0x43,0x26,0x48,0x9C,0xCF,0xB1,0x07,0xEB,0xA0,0xC8,0x69,0xDF,0x54,0x87,0xD1,0x69,0x19,0x7E,0xFD,0x85,0x15,0x29,0x9F,0x35,0xFB,0x3C,0x08,0x55,0xFD,0xD1,0x41,0xBC,0xA0,0x97,0x67,0xF6,0x7A,0x62,0xF4,0xE8,0x01,0x06,0x51,0xB5,0x96,0x8B,0x55,0x0E,0x6A,0xD1,0x8B,0x08,0x3F,0xE7,0xD4,0xFF,0x43,0x0D,0x8B,0x73,0x74,0x93,0xE9,0x81,0xD0,0x92,0x31,0xFD,0x28,0x4D,0x61,0x59,0xF9,0x78,0x1D,0x81,0xE0,0x10,0xF9,0xD9,0x48,0x83,0x53,0x91,0x6C,0x3F,0xDA,0xAC,0x0A,0x61,0x9D,0xC5,0x41,
	//0x47,0x00,0x2D,0x3B,0xBF,0xB1,0xA1,0x5C,0x23,0xFD,0x63,
	0x17,0x33,0xC3,0x90,0x22,0xAC,0x18,0xB0,0x45,0x3B,0x25,0x50,0x97,0x07,0x44,0xA5,0xC9,0x8D,0x3B,0xFD,0x04,0xF6,0x61,0x88,0xF1,0xF2,0x32,0x01,0xD9,0xEC,0x82,0xD7,0x61,0x39,0x4D,0x01,0xC9,0x12,0xDF,0x06,0xDA,0xEE,0xB6,0x77,0xFD,0x53,0x42,0xAE,0x28,0x55,0xD4,0xF1,0xB9,0x7B,0x6A,0x6C,0x9A,0xCB,0xA8,0x74,0x2F,0xEC,0x37,0x7E,0x93,0x1B,0xCB,0x56,0xF6,0x17,0x5D,0xAF,0xD6,0xC1,0xFF,0x54,0x48,0x52,0x4D,0x10,0x01,0xAD,0x00,0x1D,0x86,0xCF,0x47,0xA9,0x72,0x2C,0x47,0x2B,0x1A,0x1A,0xC9,0x57,0xEC,0xF5,0xBE,0x7A,0x87,0x4B,0x3D,0x66,0x56,0x4C,0xF9,0xD8,0x63,0xBF,0x1C,0x14,0x0C,0xB4,0xED,0xDE,0x4F,0x3D,0x1D,0x2D,0xE8,0xDD,0xC2,0xB1,0xB9,0x8B,0x76,0x63,0x13,0x23,0xFC,0x42,0x70,0xD7,0x29,0xD2,0xAB,0x10,0x0E,0x70,0x71,0x1F,0x35,0xFA,0xBD,0xDC,0x89,0xAC,0x62,0x73,0xEC,0x5F,0x42,0x99,0x1D,0x54,0xBB,0x1E,0x75,0x9E,0x62,0x16,0xF1,0xC7,0x40,0x3F,0xF8,0x04,0x7D,0x7F,0xE0,0x71,0x4C,0x4D,0x4B,0xD3,0xE1,
	0x47,0x00,0x2D,0x47,0x63,0x77,0x60,0x3B,0xED,0x51,0xD6,0x7B,0x6A,0xFC,0x71,0x72,0xE9,0xE9,0x6B,0x03,0xCC,0x4A,0xA3,0xD4,0x02,0x3A,0x42,0xF3,0x82,0x59,0xD2,0xB0,0xED,0xD6,0xA0,0x46,0xFE,0x60,0x52,0x81,0xAF,0x17,0x10,0x74,0xFD,0x11,0xBC,0x73,0xDE,0x61,0x26,0x32,0x0E,0xCF,0xB5,0x7D,0x70,0xB1,0xC3,0xB4,0x9B,0x5C,0x38,0x29,0x2A,0xF0,0x77,0x57,0x8E,0x3E,0xFF,0xD8,0x3E,0xA5,0xB5,0x7B,0xD7,0x44,0x0E,0x70,0xB9,0x45,0x5D,0xAA,0x45,0x70,0xEB,0xA5,0xF6,0xA9,0xA3,0x3B,0x35,0xAB,0x11,0x49,0xD6,0xEA,0xED,0xA8,0x14,0xB3,0x3F,0xA9,0x6D,0x79,0x22,0xAE,0x7B,0x31,0x7F,0x04,0xE5,0xBC,0xCB,0xA6,0x9D,0xDA,0xA5,0x83,0x00,0xB1,0x99,0x0A,0xCF,0x55,0x3F,0x30,0x05,0x4B,0x32,0x2A,0xDA,0x6F,0xD1,0x1B,0xAB,0xE7,0x45,0x5A,0xA1,0xF0,0x59,0x44,0x89,0x8C,0x6D,0x90,0x68,0x4B,0xD0,0x2F,0x75,0x3F,0xB5,0x1C,0x30,0x1F,0x4D,0xA8,0x47,0xF3,0x19,0xCC,0x18,0xA3,0x04,0xA7,0xAE,0x42,0x22,0x3B,0x7E,0xE3,0x6C,0xE1,0x38,0xE7,0x2B,0xBE,0x58,0xC5,0x0B,0xEE,0x4D,0x8A,0x30,0xDF,
	0x47,0x00,0x2D,0x71,0xE0,0xB1,0x64,0x1E,0x7E,0x70,0x3E,0x4A,0xBD,0x5B,0xBB,0x23,0x0C,0x65,0x32,0xDC,0x47,0x9B,0xFD,0xFF,0x5C,0xD2,0x04,0xEF,0xA0,0x15,0x2A,0x5F,0x0C,0x8C,0xDE,0xF1,0xEB,0xEC,0xD1,0xAF,0x8D,0xEC,0x1E,0x05,0x3B,0x9B,0xD4,0x55,0xB5,0x86,0xA6,0x04,0x0C,0x29,0x04,0xE1,0x32,0x96,0x39,0xAC,0x6F,0x09,0xF6,0x65,0xEA,0x92,0xC3,0xD1,0xC0,0x7F,0x50,0x40,0xDE,0xC4,0x5E,0x70,0x46,0x2F,0x63,0x30,0xDC,0x09,0x99,0x7D,0x16,0x7E,0xD1,0x76,0xC8,0x82,0xC3,0xD2,0xEE,0x68,0x40,0x15,0x31,0x67,0x8F,0x3B,0x48,0x04,0x05,0xF6,0x5F,0x0D,0x48,0xB0,0x19,0x7F,0xEE,0x3A,0xC1,0x17,0xF9,0xA1,0x41,0xC5,0xD7,0x73,0xC8,0x27,0x19,0x32,0x60,0xA2,0xA4,0x5D,0x86,0x0D,0x81,0x59,0x1B,0x04,0x00,0xB5,0xA2,0x2B,0x48,0x81,0x68,0x40,0x37,0x11,0x70,0x39,0xDF,0xAF,0x18,0x06,0x16,0x4E,0xB8,0x8A,0xA8,0x45,0x73,0x1B,0xA2,0xB2,0x55,0x6E,0x6D,0x3C,0xA8,0xE9,0xD5,0x9D,0x18,0x4B,0x1A,0xEC,0x22,0x67,0x4C,0x6F,0xD6,0xB6,0xD5,0xDE,0x5B,0x50,0xF6,0x5B,0x5D,0xE6,0x5B,0xC4,
	0x47,0x40,0x2D,0xB8,0xF7,0xCF,0xFF,0x33,0x2C,0x3E,0x9C,0x3D,0xD4,0xDF,0x4E,0x15,0x2B,0x39,0x4C,0x00,0xDA,0x4B,0xC5,0xB1,0xA8,0x99,0xBE,0x1E,0xF6,0x0F,0x07,0x83,0x71,0x24,0x51,0x2D,0xE7,0x3C,0x01,0x95,0x3C,0x59,0xB3,0x58,0xD0,0xCB,0x3B,0x80,0x54,0xF5,0xAD,0x5E,0x40,0x6F,0x7B,0x36,0x40,0xF4,0x5F,0xF5,0x5D,0x01,0xAE,0xC2,0x26,0x7D,0x5A,0x66,0x00,0x2B,0xE5,0x75,0x49,0x7C,0x8A,0xA9,0xA4,0xFE,0x06,0x71,0xE0,0x39,0x01,0xBB,0xAE,0xB1,0x1E,0x3F,0x5E,0xEB,0x37,0x68,0x5E,0xEB,0x82,0xD9,0x34,0x28,0xB6,0x24,0xEC,0x0E,0x88,0x9F,0xA8,0x1D,0xF0,0x33,0xDF,0x8A,0x64,0x73,0xF0,0x59,0x43,0x42,0xDF,0x34,0xAE,0x5A,0x93,0xDD,0xAC,0x6D,0x29,0x98,0xDE,0x62,0x7F,0x6F,0xA1,0x86,0x80,0x6A,0xBE,0xF9,0x1D,0x83,0x69,0x6D,0x87,0x51,0xE2,0xD5,0xC8,0xD2,0x05,0x4D,0xE4,0x10,0x97,0x77,0x31,0x4F,0x34,0x9F,0xDD,0x60,0xD0,0xEF,0x02,0xFC,0xDF,0x37,0x09,0x46,0xD0,0x6C,0x69,0x73,0x88,0xCF,0xE1,0x7B,0x55,0xA2,0xC0,0xA6,0x03,0x31,0xCF,0x58,0xB6,0xFE,0xEE,0xEE,0xEF,0x91,
	0x47,0x40,0x2D,0x00,0x05,0xDC,0x45,0x00,0x05,0xDC,0x62,0xB5,0x40,0x00,0x20,0x11,0xDD,0x3D,0x0A,0x14
};
#endif

int atsc3_alp_file_ring_read_data(
        unsigned char** pp_rp,
        UINT32*     p_len,
        UINT8       tp_id
)
{
#ifdef ALP_188_STATIC_TEST
        static int counter =0;
        if(counter%2 == 0){
                *pp_rp = testdata;
                *p_len = sizeof(testdata);
        }else{
                *pp_rp = testdata2;
                *p_len = sizeof(testdata2);
        }
        counter++;
#else
        int result;
        unsigned char *temp;
        result = TP_ReadData_NoNeedAligment(tp_id, pp_rp, p_len, 1024, TP_BUFFER_MASS_DATA);
		
        if(result < 0) {
                *p_len = 0;
        } else {
                temp = *pp_rp;
                *pp_rp = Tp_Buf_Phy_to_Vir(tp_id, TP_BUFFER_MASS_DATA, (unsigned char*)*pp_rp);
                if(*pp_rp == NULL) {
                        ATSC3_ALP_DMX_ERROR("pp_rp = 0x%p result=%d\n", temp, result);
                }
        }
#endif

        return 0;
}


/*======================================================
 * Func  : atsc3_alp_file_ring_release_data
 *
 * Desc  :
 *
 * Param :
 *
 * Retn  : N/A
 *======================================================*/
int atsc3_alp_file_ring_release_data(
        unsigned char*  p_rp,
        UINT32      len,
        UINT8       tp_id
)
{
        p_rp = Tp_Buf_Vir_to_Phy(tp_id, TP_BUFFER_MASS_DATA, (unsigned char*)p_rp);
        TP_ReleaseData_NoNeedAligment(tp_id, p_rp, len, TP_BUFFER_MASS_DATA);
        return 0;
}

/*======================================================
 * Func  : atsc3_alp_file_ring_get_free_space
 *
 * Desc  :
 *
 * Param :
 *
 * Retn  : N/A
 *======================================================*/
int atsc3_alp_file_ring_get_free_space(
        unsigned char**          pp_wp,
        unsigned long*          p_len
)
{
        return 0;
}

/*======================================================
 * Func  : atsc3_alp_file_ring_put_data
 *
 * Desc  :
 *
 * Param :
 *
 * Retn  : N/A
 *======================================================*/
int atsc3_alp_file_ring_put_data(
        unsigned char*          p_wp,
        unsigned long           len
)
{
        return 0;
}

